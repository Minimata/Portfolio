#!/bin/bash
cd /home/ecolvm1/dataInterface/ecol-data-interface/v3.0/data-interface/
git pull
echo 'installing packages'
npm install
echo 'building meteor app'
meteor build dist
cd dist
echo 'unpacking meteor dist'
sudo tar xzf data-interface.tar.gz
cd bundle/programs/server
echo 'installing dependencies'
sudo npm install --production

echo 'copying to destination'
sudo cp -RT /home/ecolvm1/dataInterface/ecol-data-interface/v3.0/data-interface/dist/ /var/www/data-interface
cd /var/www/data-interface
sudo rm -rf /home/ecolvm1/dataInterface/ecol-data-interface/v3.0/data-interface/dist/

echo 'starting database'
sudo service mongod start

echo 'restarting server'
sudo apache2ctl restart
